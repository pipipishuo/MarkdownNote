# cr0寄存器

开发手册  volume3.A  2.5CONTROL REGISTERS    3137页

cro 管着保护模式 分页开启



# MSR寄存器



```
model specific register (MSR) 缩写
```

相关指令

```
RDMSR  	读
WRMSR	写
```



# IA-32E模式

## 模式的说明

手册位置 Vol. 3A 2-7   2.2 MODES OF OPERATION 



这个里面说的很明确了

```
Intel 64 architecture supports all operating modes of IA-32 architecture and IA-32e modes:

•IA-32e mode — In IA-32e mode, the processor supports two sub-modes: compatibility mode and 64-bit

mode. 64-bit mode provides 64-bit linear addressing and support for physical address space larger than 64

GBytes. Compatibility mode allows most legacy protected-mode applications to run unchanged.
```



## 初始化顺序

这个就是启用64位虚拟地址  妈的 叫这么个逼名

文档位置  11.8.5 Initializing IA-32e Mode   

```
Operating systems should follow this sequence to initialize IA-32e mode:

1. Starting from protected mode, disable paging by setting CR0.PG = 0. Use the MOV CR0 instruction to disable paging (the instruction must be located in an identity-mapped page).

2. Enable physical-address extensions (PAE) by setting CR4.PAE = 1. Failure to enable PAE will result in a #GPfault when an attempt is made to initialize IA-32e mode.

3. Load CR3 with the physical base address of the Level 4 page map table (PML4) or Level 5 page map table(PML5).

4. Enable IA-32e mode by setting IA32_EFER.LME = 1.
  
5. Enable paging by setting CR0.PG = 1. This causes the processor to set the IA32_EFER.LMA bit to 1. The MOV CR0 instruction that enables paging and the following instructions must be located in an identity-mapped page (until such time that a branch to non-identity mapped pages can be effected).
```



对于步骤四具体指令看这里 看开发手册4665页  Register Address: C000_0080H  可搜索关键字“Enables IA-32e mode operation”
